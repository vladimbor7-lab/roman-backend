<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Travel AI — Вход</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --cream:  #f5f0e8;
  --cream2: #ede8dc;
  --parch:  #f9f6f0;
  --ink:    #1a1814;
  --ink2:   #3d3830;
  --ink3:   #7a7268;
  --gold:   #9a7f4e;
  --gold2:  #c4a96e;
  --border: #d9d2c4;
  --green:  #4a7c59;
  --red:    #8b3a3a;
}
*{box-sizing:border-box;margin:0;padding:0;}

body {
  font-family:'DM Sans',sans-serif;
  background:var(--cream);
  min-height:100vh;
  display:grid;
  grid-template-columns:1fr 1fr;
}

/* ── LEFT ── */
.left {
  background:var(--ink);
  display:flex;flex-direction:column;justify-content:space-between;
  padding:52px 56px;position:relative;overflow:hidden;
}
.left::before{
  content:'';position:absolute;inset:0;
  background:radial-gradient(circle at 20% 80%,rgba(154,127,78,.12) 0%,transparent 50%),
             radial-gradient(circle at 80% 20%,rgba(154,127,78,.07) 0%,transparent 50%);
  pointer-events:none;
}

.logo-eyebrow{font-size:10px;font-weight:600;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,.3);margin-bottom:10px;}
.logo-wordmark{font-family:'Cormorant Garamond',serif;font-size:36px;font-weight:300;color:#fff;letter-spacing:-.5px;position:relative;z-index:1;}
.logo-wordmark em{font-style:italic;color:var(--gold2);}

.hero{position:relative;z-index:1;}
.hero-quote{
  font-family:'Cormorant Garamond',serif;
  font-size:42px;font-weight:300;font-style:italic;
  color:#fff;line-height:1.25;margin-bottom:24px;letter-spacing:-.3px;
}
.hero-quote em{color:var(--gold2);font-style:normal;}
.hero-sub{font-size:14px;font-weight:300;color:rgba(255,255,255,.4);line-height:1.7;max-width:380px;}

.left-stats{
  display:flex;gap:40px;
  position:relative;z-index:1;
  padding-top:32px;border-top:1px solid rgba(255,255,255,.08);
}
.stat-num{font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:300;color:var(--gold2);}
.stat-lbl{font-size:11px;font-weight:300;color:rgba(255,255,255,.3);margin-top:2px;}

/* ── RIGHT ── */
.right{
  display:flex;align-items:center;justify-content:center;
  padding:48px 64px;background:var(--parch);
}
.box{width:100%;max-width:400px;}

.f-eyebrow{font-size:10px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:10px;}
.f-title{font-family:'Cormorant Garamond',serif;font-size:34px;font-weight:300;color:var(--ink);margin-bottom:6px;line-height:1.2;}
.f-title em{font-style:italic;color:var(--gold);}
.f-sub{font-size:13px;font-weight:300;color:var(--ink3);margin-bottom:36px;line-height:1.6;}

/* TABS */
.tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:28px;}
.tab{padding:10px 0;margin-right:28px;font-size:13px;font-weight:500;color:var(--ink3);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .2s;}
.tab:hover{color:var(--ink);}
.tab.on{color:var(--ink);border-color:var(--gold);}

.form{display:none;}
.form.on{display:block;}

/* FIELDS */
.fld{margin-bottom:18px;}
.fld label{display:block;font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--ink3);margin-bottom:7px;}
.fld input{
  width:100%;background:var(--cream);border:1.5px solid var(--border);border-radius:10px;
  padding:13px 15px;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--ink);
  outline:none;transition:border-color .2s,box-shadow .2s;
}
.fld input:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(154,127,78,.1);background:#fff;}
.fld input::placeholder{color:var(--ink3);opacity:.5;}
.fld input.mono{font-family:'Courier New',monospace;font-size:13px;color:var(--gold);letter-spacing:.5px;}
.fld-hint{font-size:11px;color:var(--ink3);font-weight:300;margin-top:5px;}

/* BUTTON */
.btn-main{
  width:100%;padding:14px;background:var(--ink);color:#fff;
  border:none;border-radius:10px;
  font-family:'DM Sans',sans-serif;font-size:14px;font-weight:500;
  cursor:pointer;transition:all .2s;margin-top:4px;
}
.btn-main:hover{background:var(--ink2);transform:translateY(-1px);box-shadow:0 6px 20px rgba(26,24,20,.2);}
.btn-main:disabled{opacity:.5;cursor:not-allowed;transform:none;}

/* OR */
.or{display:flex;align-items:center;gap:12px;margin:20px 0;color:var(--ink3);font-size:12px;}
.or-line{flex:1;height:1px;background:var(--border);}

/* ALERT */
.alert{border-radius:10px;padding:12px 15px;font-size:13px;font-weight:300;margin-bottom:18px;display:none;}
.alert.show{display:block;}
.alert.err{background:rgba(139,58,58,.08);border:1px solid rgba(139,58,58,.2);color:var(--red);}
.alert.ok{background:rgba(74,124,89,.08);border:1px solid rgba(74,124,89,.2);color:var(--green);}

/* FOOTER */
.footer{margin-top:32px;padding-top:22px;border-top:1px solid var(--border);font-size:12px;color:var(--ink3);font-weight:300;text-align:center;line-height:1.8;}
.footer a{color:var(--gold);text-decoration:none;}
.footer a:hover{text-decoration:underline;}

/* SPINNER */
.sp{display:inline-block;width:13px;height:13px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;margin-right:7px;vertical-align:middle;}
@keyframes spin{to{transform:rotate(360deg);}}

@media(max-width:768px){body{grid-template-columns:1fr;}.left{display:none;}.right{padding:36px 24px;}}
</style>
</head>
<body>

<!-- LEFT -->
<div class="left">
  <div>
    <div class="logo-eyebrow">SaaS платформа</div>
    <div class="logo-wordmark">Travel <em>AI</em></div>
  </div>

  <div class="hero">
    <div class="hero-quote">
      Персональный ИИ-ассистент<br>для <em>каждого</em> турагентства
    </div>
    <div class="hero-sub">
      Ваш бот с вашим именем, вашими цветами и вашей базой туров.
      Клиенты думают что это ваша разработка — и это правда.
    </div>
  </div>

  <div class="left-stats">
    <div><div class="stat-num">3</div><div class="stat-lbl">тарифных плана</div></div>
    <div><div class="stat-num">5 мин</div><div class="stat-lbl">до запуска</div></div>
    <div><div class="stat-num">AES-256</div><div class="stat-lbl">шифрование</div></div>
  </div>
</div>

<!-- RIGHT -->
<div class="right">
  <div class="box">
    <div class="f-eyebrow">Панель агентства</div>
    <div class="f-title">Добро<br>пожаловать <em>назад</em></div>
    <div class="f-sub">Войдите чтобы управлять ботом,<br>смотреть лиды и настраивать интеграции.</div>

    <div class="tabs">
      <div class="tab on" onclick="switchTab('key',this)">По ключу</div>
      <div class="tab" onclick="switchTab('pass',this)">Email и пароль</div>
    </div>

    <div class="alert" id="alertBox"></div>

    <!-- FORM KEY -->
    <div class="form on" id="formKey">
      <div class="fld">
        <label>API-ключ агентства</label>
        <input class="mono" type="text" id="keyInput" placeholder="ragency_..." autocomplete="off"
          onkeydown="if(event.key==='Enter')loginKey()">
        <div class="fld-hint">Ключ выдаётся при регистрации в Travel AI</div>
      </div>
      <button class="btn-main" id="keyBtn" onclick="loginKey()">Войти →</button>

      <div class="or"><div class="or-line"></div>или<div class="or-line"></div></div>
      <div style="font-size:13px;color:var(--ink3);text-align:center;">
        Нет аккаунта? <a href="/cdn-cgi/l/email-protection#86eee3eaeae9c6f2f4e7f0e3eaabe7efa8f4f3">Свяжитесь с нами →</a>
      </div>
    </div>

    <!-- FORM PASS -->
    <div class="form" id="formPass">
      <div class="fld">
        <label>Email</label>
        <input type="email" id="emailInput" placeholder="agency@example.com"
          onkeydown="if(event.key==='Enter')document.getElementById('passInput').focus()">
      </div>
      <div class="fld">
        <label>Пароль</label>
        <input type="password" id="passInput" placeholder="••••••••"
          onkeydown="if(event.key==='Enter')loginPass()">
        <div class="fld-hint" style="text-align:right;margin-top:6px;">
          <a href="#" style="color:var(--gold);text-decoration:none;">Забыли пароль?</a>
        </div>
      </div>
      <button class="btn-main" id="passBtn" onclick="loginPass()">Войти →</button>
    </div>

    <div class="footer">
      Travel AI © 2026 &nbsp;·&nbsp;
      <a href="#">Условия</a> &nbsp;·&nbsp;
      <a href="#">Поддержка</a>
    </div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
const API = 'https://zealous-simplicity-ad.up.railway.app'; // ← заменить на Railway URL

function switchTab(type, el) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('on'));
  el.classList.add('on');
  document.querySelectorAll('.form').forEach(f => f.classList.remove('on'));
  document.getElementById('form' + (type === 'key' ? 'Key' : 'Pass')).classList.add('on');
  hideAlert();
}

function alert_(msg, type='err') {
  const el = document.getElementById('alertBox');
  el.textContent = msg;
  el.className = 'alert show ' + type;
}
function hideAlert() { document.getElementById('alertBox').className = 'alert'; }

async function loginKey() {
  const key = document.getElementById('keyInput').value.trim();
  if (!key) { alert_('Введите API-ключ агентства'); return; }
  if (!key.startsWith('ragency_')) { alert_('Неверный формат — ключ начинается с ragency_'); return; }

  const btn = document.getElementById('keyBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="sp"></span>Проверяем...';

  try {
    const res = await fetch(`${API}/api/agency/config`, {
      headers: { 'x-agency-key': key, 'Content-Type': 'application/json' }
    });
    if (res.ok) {
      localStorage.setItem('agency_key', key);
      alert_('Добро пожаловать! Переходим в панель...', 'ok');
      setTimeout(() => window.location.href = 'roman-agency-panel.html', 1100);
    } else {
      alert_('Ключ не найден или агентство заблокировано');
      btn.disabled = false; btn.textContent = 'Войти →';
    }
  } catch(e) {
    // Демо-режим
    localStorage.setItem('agency_key', key);
    alert_('Сервер недоступен — открываем в демо-режиме', 'ok');
    setTimeout(() => window.location.href = 'roman-agency-panel.html', 1100);
  }
}

async function loginPass() {
  const email = document.getElementById('emailInput').value.trim();
  const pass  = document.getElementById('passInput').value;
  if (!email || !pass) { alert_('Заполните email и пароль'); return; }

  const btn = document.getElementById('passBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="sp"></span>Входим...';

  try {
    const res = await fetch(`${API}/api/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password: pass })
    });
    const data = await res.json();
    if (res.ok && data.api_key) {
      localStorage.setItem('agency_key', data.api_key);
      alert_('Успешно! Переходим...', 'ok');
      setTimeout(() => window.location.href = 'roman-agency-panel.html', 1000);
    } else {
      alert_(data.error || 'Неверный email или пароль');
      btn.disabled = false; btn.textContent = 'Войти →';
    }
  } catch(e) {
    alert_('Нет соединения с сервером');
    btn.disabled = false; btn.textContent = 'Войти →';
  }
}

// Если ключ уже есть — подс